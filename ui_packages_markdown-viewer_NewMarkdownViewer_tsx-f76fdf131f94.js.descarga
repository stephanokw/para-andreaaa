"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["ui_packages_markdown-viewer_NewMarkdownViewer_tsx"],{62312:(e,t,s)=>{s.d(t,{A:()=>Y});var i=s(74848),n=s(63867),l=s(27851),a=s(96540),r=s(45968),o=s(40961),d=s(5989);let m={"task-list-item":"TaskListItems-module__task-list-item--gViR6","numbered-task-list":"TaskListItems-module__numbered-task-list--WRIlb","numbered-task-list-nested":"TaskListItems-module__numbered-task-list-nested--eiXja","unordered-task-list":"TaskListItems-module__unordered-task-list--WS9ke","unordered-task-list-nested":"TaskListItems-module__unordered-task-list-nested--iS6sh","bullet-task-item":"TaskListItems-module__bullet-task-item--CGGup","numbered-task-item":"TaskListItems-module__numbered-task-item--Zjsc8","nested-overlay-list":"TaskListItems-module__nested-overlay-list--DWd6q","overlay-task-list-child":"TaskListItems-module__overlay-task-list-child--q26YD"};var c=s(30422),u=s(65607),h=s(75177),k=s(64575);let p=e=>"string"==typeof e?.taskBox&&e?.text?.match(/[^\s\\]/)!==null,g=({container:e,nestedItems:t,globalIndex:s,markdownIndex:i,items:n,itemsData:l,nested:a=!1,lists:r,parentIsChecklist:o,hasDifferentListTypes:d})=>(n.map((n,m)=>{let c=Array.from(n.querySelectorAll(":scope > ul > li:not(.base-task-list-item), :scope > ol > li:not(.base-task-list-item)"))??[],u=Array.from(n.querySelectorAll(":scope > ul > li.task-list-item, :scope > ol > li.task-list-item"))??[],h=(Array.from(n.querySelectorAll("ul > li.task-list-item, ol > li.task-list-item, li.task-list-item"))??[]).length,k=[];h>0&&t.set(s.toString(),h);let p=n.classList.contains("task-list-item")?function(e,t){let s=t.parentElement?.closest(".contains-task-list");if(!s)throw Error("Could not find the item's parent list");let i=t?Array.from(s.children).indexOf(t):-1;return[e.indexOf(s),i]}(r,n):void 0,{title:x,content:f}=function(e){let t="",s="";for(let n of e.childNodes){var i;if("INPUT"===(i=n).nodeName||"UL"===i.nodeName||"OL"===i.nodeName||"#comment"===n.nodeName)continue;let e=n.textContent||"";if("#text"===n.nodeName){t+=e,s+=e;continue}if("CODE"===n.nodeName){t+=`\`${e}\``,s+=n.outerHTML;continue}t+=e,s+=n.outerHTML}return{title:t.trim(),content:s}}(n);l.push({id:s.toString(),index:m,title:x,content:f,checked:n.querySelector(".task-list-item-checkbox")?.checked===!0,position:p,container:n.parentElement,nested:a,children:k,markdownIndex:n.classList.contains("task-list-item")?i+=1:-1,isBullet:n.parentElement?.tagName==="UL"&&!n.classList.contains("task-list-item"),isNumbered:n.parentElement?.tagName==="OL"&&!n.classList.contains("task-list-item"),parentIsChecklist:o,hasNestedItems:h>0,hasDifferentListTypes:d});let b=c.length>0&&g({container:e,nestedItems:t,globalIndex:s+1,markdownIndex:i,items:c,itemsData:k,nested:!0,lists:r,parentIsChecklist:n.classList.contains("task-list-item"),hasDifferentListTypes:u.length>0&&c.length!==u.length});s=b?b.globalIndex:s+1,i=b?b.markdownIndex:i}),{globalIndex:s,markdownIndex:i}),x=async({markdownValue:e,markdownIndex:t,onChange:s})=>{let i=e.split(/\r?\n/),n=null,l=!1;for(let e=0,a=0;e<i.length;e++){let r=i[e];if(r.trim().startsWith("\x3c!--")&&(l=!0),l){r.trim().endsWith("--\x3e")&&(l=!1);continue}if(n){if(I(r,n)){n=null;continue}}else n=b(r);if(n)continue;let o=(0,k.VB)(r);if(p(o)){if(a===t){let t=(0,k.a1)(f(o));i.splice(e,1,t);let n=i.join(`
`);return await s(n)}a++}}},f=e=>({...e,taskBox:"[ ]"===e.taskBox?"[x]":"[ ]"}),b=e=>{let t=e.match(/^ {0,3}(`{3,}|~{3,})[^`]*$/);return t?t[1]:null},I=(e,t)=>RegExp(`^ {0,3}${t}${t[0]}* *$`).test(e),v={"task-list-item":"TaskListItem-module__task-list-item--hncv0",disabled:"TaskListItem-module__disabled--rVvkq","no-convert-task-list-item":"TaskListItem-module__no-convert-task-list-item--h_Byp","left-aligned-content":"TaskListItem-module__left-aligned-content--PRNTb","checkbox-items":"TaskListItem-module__checkbox-items--F0Yz2","drag-drop-container":"TaskListItem-module__drag-drop-container--ivNfi","drag-handle-icon":"TaskListItem-module__drag-handle-icon--WPdxE","show-trigger":"TaskListItem-module__show-trigger--pr6Zf","task-list-html":"TaskListItem-module__task-list-html--PQxW3",Checkbox:"TaskListItem-module__Checkbox--FfpYz"};var y=s(10569),L=s(87330),T=s(15385),N=s(38621);let w={convertToIssue:"Convert to issue",convertToSubIssue:"Convert to sub-issue",moveUp:"Move up",moveDown:"Move down",openTaskOptions:e=>`Open ${e} task options`},_=({totalItems:e,onConvertToIssue:t,onConvertToSubIssue:s,item:n,allowIssueConversion:l,allowSubIssueConversion:r,disabled:o,setIsConverting:m,allowReordering:c,...u})=>{let{title:h,index:k,id:p}=n,{moveToPosition:g}=(0,d.gY)(),[x,f]=(0,a.useState)(!1),b=(0,a.useMemo)(()=>`task-list-menu-item-${p}`,[p]),I=e=>{if(e){let e=Array.from(document.querySelectorAll('[id^="task-list-menu-item-"]'));if(e.length>0){let t=e[Math.min(k,e.length-1)];t?.focus()}}else{let e=document.getElementById(b);e&&e.focus()}},v=({moveAction:e,e:t})=>{switch(t.preventDefault(),t.stopPropagation(),f(!1),e){case"up":g(k,k-1,!0);break;case"down":g(k,k+1,!1)}},_=({e,move:i,convertToIssue:l,convertToSubIssue:a})=>{e.preventDefault(),e.stopPropagation(),"Enter"===e.code&&i&&v({moveAction:i,e}),"Enter"===e.code&&l&&(f(!1),t?.(n,m,()=>{I(!1)})),"Enter"===e.code&&a&&(f(!1),s?.(n,m,()=>{I(!0)})),"Escape"===e.code&&f(!1)};return(0,i.jsxs)(y.W,{open:x,onOpenChange:f,children:[(0,i.jsx)(y.W.Anchor,{id:b,children:(0,i.jsx)(L.K,{"data-testid":u["data-testid"],icon:N.KebabHorizontalIcon,variant:"invisible","aria-label":w.openTaskOptions(h),disabled:o,sx:{width:"24px",height:"24px",":disabled":{background:"none",cursor:"inherit"}}})}),(0,i.jsx)(y.W.Overlay,{children:(0,i.jsxs)(T.l,{children:[c&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(T.l.Item,{onClick:e=>v({moveAction:"up",e}),onKeyDown:e=>_({e,move:"up"}),disabled:0===k,children:[(0,i.jsx)(T.l.LeadingVisual,{children:(0,i.jsx)(N.ChevronUpIcon,{})}),w.moveUp]}),(0,i.jsxs)(T.l.Item,{onClick:e=>v({moveAction:"down",e}),onKeyDown:e=>_({e,move:"down"}),disabled:k===e-1,children:[(0,i.jsx)(T.l.LeadingVisual,{children:(0,i.jsx)(N.ChevronDownIcon,{})}),w.moveDown]})]}),l&&t&&(0,i.jsxs)(T.l.Item,{onClick:()=>t?.(n,m),onKeyDown:e=>_({e,convertToIssue:!0}),"data-testid":u["data-testid"]&&`${u["data-testid"]}-convert`,children:[(0,i.jsx)(T.l.LeadingVisual,{children:(0,i.jsx)(N.IssueOpenedIcon,{})}),w.convertToIssue]}),r&&s&&(0,i.jsxs)(T.l.Item,{onClick:()=>s?.(n,m),onKeyDown:e=>_({e,convertToSubIssue:!0}),"data-testid":u["data-testid"]&&`${u["data-testid"]}-convert-sub-issue`,children:[(0,i.jsx)(T.l.LeadingVisual,{children:(0,i.jsx)(N.IssueTracksIcon,{})}),w.convertToSubIssue]})]})})]})};try{_.displayName||(_.displayName="TaskListMenu")}catch{}let j=/\/issues\/\d*\d/,S=(e,t)=>{let s=document.createElement("div");s.innerHTML=e;let i=s.querySelectorAll("span.reference");if(0===i.length)return!0;if(t||i.length>1)return!1;let n=i[0];return n.remove(),""===s.innerHTML.trim()&&!!j.test(n.innerHTML)};function C({markdownValue:e,onChange:t,onConvertToIssue:s,onConvertToSubIssue:l,nested:r=!1,position:o=1,item:m,totalItems:k,disabled:p,hideActions:g,itemIdToFocus:f,setitemIdToFocus:b,toggledItem:I,setToggledItem:y}){let[L,T]=(0,a.useState)(m.checked),[N,w]=(0,a.useState)(!1),[j,C]=(0,a.useState)(!1),$=e=>{let t=document.getElementById(`task-list-menu-item-${e}`);t&&t.focus()};(0,a.useEffect)(()=>{f&&!p&&($(f),b?.(null))},[f,p,b]),(0,a.useEffect)(()=>{I&&!p&&y(null)},[I,p,y]);let D=(0,a.useCallback)(e=>{T(!m.checked),y(m.id),x({markdownValue:e,markdownIndex:m.markdownIndex,onChange:t})},[m,t,y]),A=!r&&!m.hasDifferentListTypes||r&&o<2&&!m.parentIsChecklist&&!m.hasDifferentListTypes,[B,M]=(0,a.useMemo)(()=>[S(m.content,!0),S(m.content,!1)],[m.content]),E=`tasklist-item-${o}-${m.markdownIndex}`,O=!r||s&&l?v["task-list-item"]:v["no-convert-task-list-item"];return O+=` ${r&&k>0?"contains-task-list":""}`,O+=p?` ${v.disabled}`:"",(0,i.jsxs)("div",{className:O,onMouseEnter:()=>w(!0),onMouseLeave:()=>w(!1),"data-testid":E,children:[(0,i.jsxs)("div",{className:v["left-aligned-content"],children:[(0,i.jsx)("div",{className:v["drag-drop-container"],children:A&&!p&&(0,i.jsx)(d.BS.DragTrigger,{className:`${v["drag-handle-icon"]} ${N?v["show-trigger"]:""}`,style:{width:"20px",height:"28px"}})}),(0,i.jsxs)("div",{className:v["checkbox-items"],id:`checkbox-item-${m.id}`,children:[(0,i.jsx)(u.A,{autoFocus:m.id===I,checked:L,disabled:p,onChange:t=>{t.preventDefault(),t.stopPropagation(),D(e)},"aria-label":`${m.title} checklist item`,className:v.Checkbox}),(0,i.jsx)(c.JU,{html:m.content,className:v["task-list-html"]})]})]}),(0,i.jsxs)(h.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexShrink:0,flexBasis:"28px",height:"28px"},children:[j&&(0,i.jsx)(n.A,{size:"small"}),!g&&A&&m.position&&!j&&(0,i.jsx)(_,{"data-testid":`${E}-menu`,onConvertToIssue:s,onConvertToSubIssue:l,totalItems:k,item:m,disabled:p,allowIssueConversion:B,allowSubIssueConversion:M,setIsConverting:C,allowReordering:A})]})]})}try{C.displayName||(C.displayName="TaskListItem")}catch{}function $({item:e,position:t}){let s=`tasklist-item-${t}-${e.markdownIndex}`;return(0,i.jsx)(c.Pk,{sx:{mr:6},html:e.content,as:"div","data-testid":s})}try{$.displayName||($.displayName="ListItem")}catch{}let D=(e,t,s,i,n,l)=>{let a=new Map(i),r=e.findIndex(e=>e.id===t),o=e[r];if(!o)return a;let d=[...e];d.splice(r,1);let m=d.findIndex(e=>e.id===s);d.splice(n?m:m+1,0,o);let c=i.get(l);if(!c)return a;if(c===e)a.set(l,d);else{let t=s=>{for(let i of s)i.children===e?i.children=d:i.children&&t(i.children)};t(c),a.set(l,c)}return a},A=(e,t,s,i)=>{let{startLineNumber:n,endLineNumber:l}=B(s,e),{startLineNumber:a,endLineNumber:r}=B(i,e),o=e.split(/\r?\n/),d=l-n+1,m=[...o].splice(n,d);return t?(o.splice(n,d),o.splice(a,0,...m)):(o.splice(r+1,0,...m),o.splice(n,d)),o.join(`
`)},B=(e,t)=>{let s,i=t.split(/\r?\n/),n=-1,l=-1,a=-1;for(let[t,r]of i.entries()){let i=(0,k.VB)(r),o=i?.leadingWhitespace.length;if(s&&(!r||void 0!==o&&o<=s.leadingWhitespace.length)){l=t>0?t-1:0;break}i&&p(i)&&++a===e&&(n=t,s=i)}return{startLineNumber:n,endLineNumber:l=-1===l?i.length-1:l}},M=({tasklists:e,markdownValue:t,externalOnChange:s,onConvertToIssue:n,onConvertToSubIssue:l,tasklistData:r,setTasklistData:c,disabled:u,viewerCanUpdate:h})=>{let[k,p]=(0,a.useState)(!1),[g,x]=(0,a.useState)(null),[f,b]=(0,a.useState)(null),I=(0,a.useCallback)(async({dragMetadata:e,dropMetadata:i,isBefore:n,items:l,container:a})=>{if(e.id===i?.id||u)return;p(!0);let o=l.find(t=>t.id===e.id)?.markdownIndex,d=l.find(e=>e.id===i.id)?.markdownIndex;if(void 0===o||void 0===d)return;let m=A(t,n,o,d);c(D(l,e.id,i.id,r,n,a)),s&&(await s(m),p(!1),x(i.id))},[u,t,r,c,s]),v=(0,a.useCallback)(async e=>{s&&(p(!0),await s(e),p(!1))},[s]);function y(e,s,r,o,c,p){let L=!e.isBullet&&!e.isNumbered,T="OL"===r.tagName?"ol":"UL"===r.tagName?"ul":"div";return(0,i.jsxs)(a.Fragment,{children:[L&&(0,i.jsx)(C,{toggledItem:f,setToggledItem:b,markdownValue:t,onChange:v,onConvertToIssue:n,onConvertToSubIssue:l,nested:c,position:s,item:e,totalItems:o,disabled:u||k,hideActions:!h&&!k,setitemIdToFocus:x,itemIdToFocus:g}),!L&&(0,i.jsx)($,{item:e,position:s}),e.children.length>0&&(0,i.jsx)(d.BS,{items:e.children,onDrop:t=>I({...t,items:e.children,container:r}),renderOverlay:(t,n)=>(0,i.jsx)(d.BS.Item,{index:n,id:t.id,title:t.title,hideSortableItemTrigger:!0,className:m["task-list-item"],isDragOverlay:!0,style:{marginLeft:"-30px"},children:y(t,s+1,r,e.children.length,!0,!0)},t.id),as:"div",children:(0,i.jsx)(T,{className:"base-list-item",style:{listStyleType:"none",marginLeft:L?"12px":"-28px"},children:e.children.map((t,n)=>{let l=E({child:t,position:s}),a=O({child:t,isDragOverlay:p}),o=V({child:t,isDragOverlay:p});return(0,i.jsx)(d.BS.Item,{index:n,id:t.id,title:t.title,hideSortableItemTrigger:!0,className:`${l} ${a} ${o}`,as:q(e)?"li":"div",children:y(t,s+1,r,e.children.length,!0,p)},t.id)})})})]},e.index)}return(0,a.useMemo)(()=>(0,i.jsx)(i.Fragment,{children:e.map((e,t)=>{let s=r.get(e)||[],n=s.filter(e=>!e.isBullet&&!e.isNumbered),l="OL"===e.tagName?"ol":"UL"!==e.tagName||e.classList.contains("contains-task-list")&&n.length===s.length?"div":"ul";return s.length>0?(0,o.createPortal)((0,i.jsx)("li",{className:"base-task-list-item",style:{listStyle:"none",marginLeft:"-28px"},children:(0,i.jsx)(d.BS,{items:s,onDrop:t=>I({...t,items:s,container:e}),style:{marginTop:"1px"},renderOverlay:(t,n)=>(0,i.jsx)(d.BS.Item,{index:n,id:t.id,title:t.title,hideSortableItemTrigger:!0,isDragOverlay:!0,children:y(t,0,e,s.length,!1,!0)},t.id),as:"div",children:(0,i.jsx)(l,{className:"base-list-item",style:{marginLeft:n.length!==s.length&&n.length?"5px":"0px"},children:s.map((t,n)=>(0,i.jsx)(d.BS.Item,{index:n,id:t.id,title:t.title,hideSortableItemTrigger:!0,className:t.isBullet?m["bullet-task-item"]:t.isNumbered?m["numbered-task-item"]:m["task-list-item"],as:q(t)?"li":"div",style:{marginLeft:t.isBullet||t.isNumbered||!t.hasDifferentListTypes?"0px":"-28px",marginRight:"-8px"},children:y(t,0,e,s.length,!1,!1)},t.id))})})}),e,t.toString()):null})}),[t,r,u])},E=({child:e,position:t})=>e.isNumbered?t+1<2?m["numbered-task-list"]:m["numbered-task-list-nested"]:e.isBullet?t+1<2?m["unordered-task-list"]:m["unordered-task-list-nested"]:m["task-list-item"],O=({child:e,isDragOverlay:t})=>!e.isBullet&&!e.isNumbered&&(t?m["nested-overlay-list"]:e.parentIsChecklist||e.hasDifferentListTypes?"":m["task-list-item"]),V=({child:e,isDragOverlay:t})=>(e.isBullet||e.isNumbered)&&(t?m["overlay-task-list-child"]:""),q=e=>(e.isNumbered||e.isBullet)&&!e.hasDifferentListTypes||e.hasDifferentListTypes||e.children.length>0;try{M.displayName||(M.displayName="TaskListItems")}catch{}let W={spinner:"NewMarkdownViewer-module__spinner--2QW6e","safe-html-box":"NewMarkdownViewer-module__safe-html-box--cRsz0"};var P=s(34164),R=s(17515);let U=[],F=function(e,t,s){let[i,n]=(0,a.useState)([]);return(0,R.N)(()=>{let s=Array.from(e.current?.querySelectorAll(t)??U);n(e=>!function(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}(e,s)?s:e)},[s,e,t]),i},H=(e,t)=>{let[s,i]=(0,a.useState)(()=>new Map),[n,l]=(0,a.useState)(()=>new Map);return(0,R.N)(()=>{if(!e)return;let s=function({container:e,tasklists:t}){let s=new Map,i=new Map,n=function(e,t="ul:not(.base-list-item), ol:not(.base-list-item)"){return Array.from(e.querySelectorAll(t)).filter(e=>!e.closest("tracking-block"))}(e),l=0,a=-1;for(let r of t){let t=Array.from(r.querySelectorAll(":scope > li:not(.base-task-list-item)")),o=r.querySelectorAll(":scope > li.task-list-item"),d=[],{globalIndex:m,markdownIndex:c}=g({container:e,nestedItems:i,globalIndex:l,markdownIndex:a,items:t,itemsData:d,nested:!1,lists:n,parentIsChecklist:r.classList.contains("task-list-item"),hasDifferentListTypes:o.length>0&&o.length!==t.length});for(let e of(l=m,a=c,s.set(r,d),t))e.remove()}return{newData:s,nestedItems:i}}({container:e,tasklists:t});i(s.newData),l(s.nestedItems)},[e,t]),{tasklistData:s,nestedItems:n,setTasklistData:i,setNestedItems:l}};var K=s(46847);let z=/\b(href|src)\s*=\s*(['"])([^'"?]{1,2000})(\?(?:[^'"]{0,1000}?))token=([^&#"']{0,500})([^'"]{0,1000})\2/gi,Y=({verifiedHTML:e,markdownValue:t="",onChange:s,onConvertToIssue:o,onConvertToSubIssue:d,onLinkClick:m,openLinksInNewTab:c=!1,loading:u=!1,disabled:h,viewerCanUpdate:k,className:p})=>{let g=(0,a.useRef)(null),x=F(g,".contains-task-list:not(.contains-task-list .contains-task-list)",e),f=(0,a.useRef)(""),b=(0,l.G7)("issues_preserve_tokens_in_urls"),I=(0,a.useMemo)(()=>b?function(e,t){z.lastIndex=0;let s=0;return e.replace(z,(e,i,n,l,a,r,o)=>{if(++s>1e3)return e;let d=`${l}${a}token=TOKEN_PLACEHOLDER${o}`;return t.hasOwnProperty(d)?`${i}=${n}${l}${a}token=${t[d]}${o}${n}`:e})}(e,function(e){let t,s={};z.lastIndex=0;let i=0;for(;null!==(t=z.exec(e))&&!(++i>1e3);){let e=t[3],i=t[4],n=t[5],l=t[6];e&&n&&(s[`${e}${i}token=TOKEN_PLACEHOLDER${l}`]=n)}return s}(f.current)):e,[e,b]);f.current=I;let{tasklistData:v,nestedItems:y,setTasklistData:L}=H(g.current,x);(0,K.O)({htmlContainerRef:g,onLinkClick:m,openLinksInNewTab:c});let T=(0,a.useMemo)(()=>{let e=["markdown-body",W["safe-html-box"]];return p&&e.push(p),(0,i.jsx)(r.vb,{ref:g,className:(0,P.$)(e),html:I})},[p,I]);return u?(0,i.jsx)("div",{className:(0,P.$)(W.spinner),children:(0,i.jsx)(n.A,{"aria-label":"Loading markdown content..."})}):(0,i.jsxs)(i.Fragment,{children:[T,x.length>0&&(0,i.jsx)(M,{tasklists:x,markdownValue:t,externalOnChange:s,onConvertToIssue:o,onConvertToSubIssue:d,tasklistData:v,setTasklistData:L,nestedItems:y,disabled:h||!s,viewerCanUpdate:k})]})};try{Y.displayName||(Y.displayName="NewMarkdownViewer")}catch{}}}]);
//# sourceMappingURL=ui_packages_markdown-viewer_NewMarkdownViewer_tsx-24d7095e2dd6.js.map